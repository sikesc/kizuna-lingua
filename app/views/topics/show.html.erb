<div class="topic-show">
  <!-- Topic Header -->
  <header class="topic-show__header">
    <div class="topic-show__header-content">
      <%= link_to dashboard_path, class: "topic-show__back" do %>
        <i class="fas fa-arrow-left"></i>
      <% end %>
      <div class="topic-show__title-group">
        <h1 class="topic-show__title"><%= @topic.name %></h1>
        <p class="topic-show__subtitle">
          <% if current_user.learning_language == "japanese" %>
            <%= @topic.content["eng"] %>
          <% elsif current_user.learning_language == "english" %>
            <%= @topic.content["jpn"] %>
          <% end %>
        </p>
      </div>
    </div>
  </header>

  <main class="topic-show__main">
    <!-- Grammar Points Section -->
    <section class="topic-show__section">
      <div class="section-header">
        <h2 class="section-header__title">
          <i class="fas fa-book-open"></i>
          Grammar Points
        </h2>
      </div>

      <% if @filtered_grammar_points.empty? %>
        <div class="empty-message">
          <i class="fas fa-info-circle"></i>
          <p>No grammar points are available for your <%= current_user.learning_level %> level yet.</p>
        </div>
      <% else %>
        <div class="accordion grammar-accordion" id="grammarPointsAccordion">
          <% @filtered_grammar_points.each_with_index do |grammar_point, index| %>
            <div class="accordion-item">
              <h2 class="accordion-header" id="heading<%= grammar_point.level.parameterize %>-<%= index %>">
                <button class="accordion-button <%= 'collapsed' unless index == 0 %>" type="button"
                    data-bs-toggle="collapse" data-bs-target="#collapse<%= grammar_point.level.parameterize %>-<%= index %>"
                    aria-expanded="<%= index == 0 %>" aria-controls="collapse<%= grammar_point.level.parameterize %>-<%= index %>">
                  <span class="grammar-point__title"><%= grammar_point.title %></span>
                </button>
              </h2>
              <div id="collapse<%= grammar_point.level.parameterize %>-<%= index %>" class="accordion-collapse collapse <%= 'show' if index == 0 %>"
               aria-labelledby="heading<%= grammar_point.level.parameterize %>-<%= index %>">
                <div class="accordion-body">
                  <div class="grammar-content">
                    <div class="grammar-content__block">
                      <h4 class="grammar-content__label">
                        <i class="fas fa-lightbulb"></i>
                        Explanation
                      </h4>
                      <p class="grammar-content__text"><%= grammar_point.explanation %></p>
                    </div>
                    <div class="grammar-content__block">
                      <h4 class="grammar-content__label">
                        <i class="fas fa-quote-left"></i>
                        Examples
                      </h4>
                      <p class="grammar-content__text"><%= grammar_point.examples %></p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      <% end %>
    </section>

    <!-- Written Challenge Section -->
    <section class="topic-show__section">
      <div class="section-header">
        <h2 class="section-header__title">
          <i class="fas fa-pen-fancy"></i>
          Written Challenge
        </h2>
      </div>

      <% if @challenge && @challenge.content.dig(@user_level) %>
        <div class="challenge-card">
          <div class="challenge-card__prompt">
            <p>
              <% if current_user.learning_language == "japanese" %>
                <%= @challenge.content.dig(@user_level, "en") %>
              <% elsif current_user.learning_language == "english" %>
                <%= @challenge.content.dig(@user_level, "jp") %>
              <% end %>
            </p>
          </div>

          <div class="challenge-card__form">
            <%= simple_form_for [@challenge, @journal] do |f| %>
              <%= f.input :content, as: :text, input_html: { rows: 6, class: "challenge-textarea" }, label: false, placeholder: "Write your response here..." %>
              <div class="challenge-card__actions">
                <%= f.button :submit, class: "btn-submit" do %>
                  <i class="fas fa-paper-plane"></i>
                  Submit Journal
                <% end %>
              </div>
            <% end %>
          </div>
        </div>
      <% else %>
        <div class="empty-message">
          <i class="fas fa-info-circle"></i>
          <p>No challenge available for this topic yet.</p>
        </div>
      <% end %>
    </section>
  </main>
</div>
