<!DOCTYPE html>
<html>
  <head>
    <title><%= meta_title %></title>
    <meta name="description" content="<%= meta_description %>">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%# Open Graph meta tags %>
    <meta property="og:title" content="<%= meta_title %>">
    <meta property="og:description" content="<%= meta_description %>">
    <meta property="og:image" content="<%= meta_image %>">
    <meta property="og:type" content="website">
    <%# Twitter Card meta tags %>
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="<%= meta_title %>">
    <meta name="twitter:description" content="<%= meta_description %>">
    <meta name="twitter:image" content="<%= meta_image %>">
    <link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials">
    <link rel="icon" type="image/x-icon" href="/favicon.ico?v=2">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png?v=2">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png?v=2">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png?v=2">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>
    <%= stylesheet_link_tag "application", "data-turbo-track": "reload" %>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
    <%= javascript_importmap_tags %>
    <%= render 'shared/ios_pwa_links' %>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Delius&family=Faustina:ital,wght@0,300..800;1,300..800&family=Funnel+Sans:ital,wght@0,300..800;1,300..800&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Zen+Old+Mincho&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Alan+Sans:wght@300..900&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+JP&display=swap');
      @import url('https://fonts.googleapis.com/css2?family=Story+Script&display=swap');
    </style>
  </head>
  <body data-controller="notification-panel">
    <% if current_user %>
      <%# Overlay for closing panel by clicking outside %>
      <div data-notification-panel-target="overlay"
           data-action="click->notification-panel#toggle"
           class="notification-overlay"
           style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(30,41,59,0.6); backdrop-filter: blur(2px); z-index: 1200; opacity: 0; visibility: hidden; transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;"></div>
      <%# Notification Panel (controlled by Stimulus) %>
      <div data-notification-panel-target="panel" class="notification-panel-container"
           style="position: fixed; top: 0; right: -100%; width: 100%; max-width: 400px; height: calc(100% - 70px); background: #F8FAFC; z-index: 1210; transition: right 0.3s ease-in-out; display: flex; flex-direction: column; box-shadow: -4px 0 24px rgba(30,41,59,0.15); border-bottom-left-radius: 1rem;">
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 1.25rem 1rem; background: linear-gradient(135deg, #1E293B 0%, #475569 100%); flex-shrink: 0;">
          <h3 style="margin: 0; font-size: 1.25rem; font-weight: 700; color: white; display: flex; align-items: center; gap: 0.5rem;">
            <i class="fas fa-bell" style="font-size: 1rem; color: #FF6B6B;"></i>
            Notifications
          </h3>
          <a href="#" data-action="click->notification-panel#toggle" style="display: flex; align-items: center; justify-content: center; width: 2.25rem; height: 2.25rem; background: rgba(255,255,255,0.1); border-radius: 50%; text-decoration: none; color: rgba(255,255,255,0.8);"><i class="fas fa-times" style="font-size: 0.875rem;"></i></a>
        </div>
        <div data-notification-panel-target="notifications" id="notifications-list" style="flex: 1; overflow-y: auto; padding: 1rem;">
          <% if @notifications.any? %>
            <% @notifications.each do |notification| %>
              <%= render partial: "notifications/notification", locals: { notification: notification } %>
            <% end %>
          <% else %>
            <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 3rem 1.5rem; text-align: center;">
              <div style="width: 4rem; height: 4rem; border-radius: 50%; background: linear-gradient(135deg, #E2E8F0 0%, #CBD5E1 100%); display: flex; align-items: center; justify-content: center; margin-bottom: 1rem;">
                <i class="fas fa-bell-slash" style="font-size: 1.5rem; color: #94A3B8;"></i>
              </div>
              <p style="font-size: 1rem; font-weight: 600; color: #475569; margin: 0 0 0.25rem;">No notifications yet</p>
              <p style="font-size: 0.875rem; color: #94A3B8; margin: 0;">When your partner interacts with you, you'll see it here</p>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

    <%= render "shared/flashes" %>
    <%= yield %>
    <% if current_user %>
      <%= render "shared/footer" %>
    <% end %>
  </body>
</html>
